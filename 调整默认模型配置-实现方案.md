# è°ƒæ•´é»˜è®¤æ¨¡å‹é…ç½® - å®ç°æ–¹æ¡ˆ

## ğŸ¯ éœ€æ±‚

æ–°ç”¨æˆ·æ³¨å†Œåï¼Œåœ¨æ™ºæ§å°çš„æ¨¡å‹é…ç½®ä¸­åªæ˜¾ç¤ºï¼š
- **LLM**ï¼šMinimaxLLM
- **TTS**ï¼šMinimaxTTS

å…¶ä»–æ¨¡å‹é…ç½®ä¸æ˜¾ç¤ºæˆ–ç¦ç”¨ã€‚

---

## ğŸ“ å…³é”®æ–‡ä»¶ä½ç½®

### æ•°æ®åº“åˆå§‹åŒ–æ–‡ä»¶
```
/home/moshu/xiaozhi-esp32-server/main/manager-api/src/main/resources/db/changelog/202504112044.sql
```

è¿™ä¸ªæ–‡ä»¶è´Ÿè´£åˆå§‹åŒ–æ‰€æœ‰æ¨¡å‹é…ç½®æ•°æ®ï¼ˆLLMã€TTSã€ASRã€VADã€Memoryã€Intentï¼‰ã€‚

---

## ğŸ”§ å®ç°æ–¹æ¡ˆï¼ˆ3ä¸ªæ–¹æ¡ˆå¯é€‰ï¼‰

### æ–¹æ¡ˆ1ï¼šä¿®æ”¹æ•°æ®åº“åˆå§‹åŒ–SQLï¼ˆæ¨èï¼‰â­

**ä¼˜ç‚¹**ï¼š
- ä»æ ¹æºä¸Šæ§åˆ¶ï¼Œæ•°æ®åº“ä¸­åªå­˜åœ¨éœ€è¦çš„æ¨¡å‹
- æ€§èƒ½æœ€å¥½ï¼Œä¸éœ€è¦é¢å¤–çš„è¿‡æ»¤é€»è¾‘
- éƒ¨ç½²ç®€å•ï¼Œé‡æ–°åˆå§‹åŒ–æ•°æ®åº“å³å¯

**ç¼ºç‚¹**ï¼š
- éœ€è¦é‡æ–°åˆå§‹åŒ–æ•°æ®åº“ï¼ˆå·²æœ‰æ•°æ®ä¼šä¸¢å¤±ï¼‰
- å¦‚æœä»¥åæƒ³æ·»åŠ å…¶ä»–æ¨¡å‹ï¼Œéœ€è¦ä¿®æ”¹SQLå†é‡æ–°éƒ¨ç½²

**å®ç°æ­¥éª¤**ï¼š

#### 1. å¤‡ä»½å½“å‰æ•°æ®åº“ï¼ˆå¦‚æœæœ‰é‡è¦æ•°æ®ï¼‰
```bash
# è¿›å…¥æ•°æ®åº“å®¹å™¨
sudo docker exec -it xiaozhi-esp32-server-db mysqldump -u root -p xiaozhi > backup.sql
```

#### 2. ä¿®æ”¹ `202504112044.sql` æ–‡ä»¶

æ‰¾åˆ°LLMéƒ¨åˆ†ï¼ˆç¬¬15-28è¡Œï¼‰ï¼Œ**åˆ é™¤æ‰€æœ‰å…¶ä»–LLMé…ç½®ï¼Œåªä¿ç•™**ï¼š

```sql
-- LLMæ¨¡å‹é…ç½®ï¼ˆåªä¿ç•™MinimaxLLMï¼‰
DELETE FROM `ai_model_config` WHERE model_type='LLM';
INSERT INTO `ai_model_config` VALUES ('LLM_MinimaxLLM', 'LLM', 'MinimaxLLM', 'MiniMaxå¤§è¯­è¨€æ¨¡å‹', 1, 1, '{\"type\": \"openai\", \"model_name\": \"abab6.5s-chat\", \"base_url\": \"https://api.minimaxi.com/v1\", \"api_key\": \"ä½ çš„api_key\"}', NULL, NULL, 1, NULL, NULL, NULL, NULL);
```

æ‰¾åˆ°TTSéƒ¨åˆ†ï¼ˆç¬¬30-45è¡Œï¼‰ï¼Œ**åˆ é™¤æ‰€æœ‰å…¶ä»–TTSé…ç½®ï¼Œåªä¿ç•™**ï¼š

```sql
-- TTSæ¨¡å‹é…ç½®ï¼ˆåªä¿ç•™MinimaxTTSï¼‰
DELETE FROM `ai_model_config` WHERE model_type='TTS';
INSERT INTO `ai_model_config` VALUES ('TTS_MinimaxTTS', 'TTS', 'MinimaxTTS', 'MiniMaxè¯­éŸ³åˆæˆ', 1, 1, '{\"type\": \"minimax_httpstream\", \"output_dir\": \"tmp/\", \"group_id\": \"ä½ çš„group_id\", \"api_key\": \"ä½ çš„api_key\", \"model\": \"speech-01-turbo\", \"voice_id\": \"female-shaonv\"}', NULL, NULL, 1, NULL, NULL, NULL, NULL);
```

**æ³¨æ„**ï¼š
- `is_default`å­—æ®µè®¾ä¸º`1`ï¼ˆç¬¬ä¸€ä¸ª1ï¼‰è¡¨ç¤ºé»˜è®¤é…ç½®
- `is_enabled`å­—æ®µè®¾ä¸º`1`ï¼ˆç¬¬äºŒä¸ª1ï¼‰è¡¨ç¤ºå¯ç”¨
- `sort`å­—æ®µè®¾ä¸º`1`è¡¨ç¤ºæ’åºç¬¬ä¸€

#### 3. é‡æ–°åˆå§‹åŒ–æ•°æ®åº“

**æ–¹æ³•Aï¼šé‡æ–°å¯åŠ¨æœåŠ¡ï¼ˆä¼šè‡ªåŠ¨æ‰§è¡ŒSQLï¼‰**
```bash
cd /home/moshu/xiaozhi-esp32-server/main/xiaozhi-server
sudo docker compose -f docker-compose_all.yml down
sudo docker compose -f docker-compose_all.yml up -d
```

**æ–¹æ³•Bï¼šæ‰‹åŠ¨æ‰§è¡ŒSQL**
```bash
# è¿›å…¥æ•°æ®åº“å®¹å™¨
sudo docker exec -it xiaozhi-esp32-server-db mysql -u root -p xiaozhi

# æ‰§è¡Œåˆ é™¤å’Œæ’å…¥è¯­å¥
DELETE FROM ai_model_config WHERE model_type='LLM';
DELETE FROM ai_model_config WHERE model_type='TTS';
-- ç„¶åæ‰§è¡Œä¸Šé¢çš„INSERTè¯­å¥
```

---

### æ–¹æ¡ˆ2ï¼šä¿®æ”¹åç«¯APIè¿‡æ»¤é€»è¾‘

**ä¼˜ç‚¹**ï¼š
- ä¸éœ€è¦ä¿®æ”¹æ•°æ®åº“
- çµæ´»ï¼Œå¯ä»¥é€šè¿‡é…ç½®æ§åˆ¶æ˜¾ç¤ºå“ªäº›æ¨¡å‹
- ä¸ä¼šä¸¢å¤±ç°æœ‰æ•°æ®

**ç¼ºç‚¹**ï¼š
- éœ€è¦ä¿®æ”¹Javaä»£ç å¹¶é‡æ–°ç¼–è¯‘
- æ€§èƒ½ç¨å·®ï¼ˆéœ€è¦æŸ¥è¯¢åå†è¿‡æ»¤ï¼‰

**å®ç°æ­¥éª¤**ï¼š

#### 1. ä¿®æ”¹ ModelConfigController.java æˆ– ModelConfigServiceImpl.java

æ–‡ä»¶ä½ç½®ï¼š
```
/home/moshu/xiaozhi-esp32-server/main/manager-api/src/main/java/xiaozhi/modules/model/service/impl/ModelConfigServiceImpl.java
```

åœ¨æŸ¥è¯¢æ¨¡å‹åˆ—è¡¨çš„æ–¹æ³•ä¸­æ·»åŠ è¿‡æ»¤é€»è¾‘ï¼š

```java
public List<ModelConfigEntity> list() {
    List<ModelConfigEntity> allConfigs = baseMapper.selectList(null);
    
    // è¿‡æ»¤ï¼šåªä¿ç•™MinimaxLLMå’ŒMinimaxTTS
    return allConfigs.stream()
        .filter(config -> 
            "LLM_MinimaxLLM".equals(config.getId()) || 
            "TTS_MinimaxTTS".equals(config.getId()) ||
            // ä¿ç•™å…¶ä»–å¿…éœ€çš„é…ç½®ï¼ˆVADã€ASRã€Memoryã€Intentï¼‰
            !"LLM".equals(config.getModelType()) && !"TTS".equals(config.getModelType())
        )
        .collect(Collectors.toList());
}
```

#### 2. é‡æ–°ç¼–è¯‘å’Œéƒ¨ç½²

```bash
cd /home/moshu/xiaozhi-esp32-server/main/manager-api
mvn clean package -DskipTests
# å°†ç”Ÿæˆçš„jaråŒ…æ›¿æ¢åˆ°Dockerå®¹å™¨ä¸­
```

---

### æ–¹æ¡ˆ3ï¼šä¿®æ”¹å‰ç«¯æ˜¾ç¤ºé€»è¾‘

**ä¼˜ç‚¹**ï¼š
- æœ€ç®€å•ï¼Œåªéœ€è¦ä¿®æ”¹å‰ç«¯ä»£ç 
- ä¸éœ€è¦ä¿®æ”¹æ•°æ®åº“å’Œåç«¯
- æ•°æ®ä»ç„¶å­˜åœ¨ï¼Œæ–¹ä¾¿ä»¥åæ¢å¤

**ç¼ºç‚¹**ï¼š
- åªæ˜¯éšè—ï¼Œæ•°æ®ä»ç„¶å­˜åœ¨æ•°æ®åº“ä¸­
- å¦‚æœæœ‰å…¶ä»–å‰ç«¯æˆ–APIè°ƒç”¨ï¼Œå¯èƒ½ä»èƒ½çœ‹åˆ°æ‰€æœ‰æ¨¡å‹

**å®ç°æ­¥éª¤**ï¼š

#### 1. ä¿®æ”¹ ModelConfig.vue

æ–‡ä»¶ä½ç½®ï¼š
```
/home/moshu/xiaozhi-esp32-server/main/manager-web/src/views/ModelConfig.vue
```

åœ¨è·å–æ¨¡å‹åˆ—è¡¨åæ·»åŠ è¿‡æ»¤ï¼š

```javascript
// åœ¨computedæˆ–methodsä¸­æ·»åŠ è¿‡æ»¤é€»è¾‘
filteredModelList() {
  return this.modelList.filter(model => {
    // åªæ˜¾ç¤ºMinimaxLLMå’ŒMinimaxTTSï¼Œä»¥åŠå…¶ä»–éLLM/TTSçš„æ¨¡å‹
    return model.id === 'LLM_MinimaxLLM' || 
           model.id === 'TTS_MinimaxTTS' ||
           (model.modelType !== 'LLM' && model.modelType !== 'TTS');
  });
}
```

#### 2. é‡æ–°ç¼–è¯‘å‰ç«¯

```bash
cd /home/moshu/xiaozhi-esp32-server/main/manager-web
npm run build
# å°†ç”Ÿæˆçš„distç›®å½•å¤åˆ¶åˆ°éƒ¨ç½²ä½ç½®
```

---

## ğŸ“Š ä¸‰ç§æ–¹æ¡ˆå¯¹æ¯”

| ç‰¹æ€§ | æ–¹æ¡ˆ1ï¼ˆSQLï¼‰ | æ–¹æ¡ˆ2ï¼ˆåç«¯ï¼‰ | æ–¹æ¡ˆ3ï¼ˆå‰ç«¯ï¼‰ |
|------|-------------|--------------|--------------|
| å®ç°éš¾åº¦ | â­ ç®€å• | â­â­â­ ä¸­ç­‰ | â­â­ ç®€å• |
| æ€§èƒ½å½±å“ | âœ… æ—  | âš ï¸ è½»å¾® | âœ… æ—  |
| æ•°æ®å®‰å…¨ | âš ï¸ éœ€é‡æ–°åˆå§‹åŒ– | âœ… ä¸å½±å“ç°æœ‰æ•°æ® | âœ… ä¸å½±å“ç°æœ‰æ•°æ® |
| çµæ´»æ€§ | âŒ ä½ | âœ… é«˜ | âš ï¸ ä¸­ |
| æ¨èç¨‹åº¦ | â­â­â­â­â­ | â­â­â­ | â­â­ |

---

## ğŸ’¡ æ¨èå®æ–½æ–¹æ¡ˆ

### å¦‚æœæ˜¯æ–°éƒ¨ç½²ï¼ˆæ•°æ®åº“ä¸ºç©ºæˆ–å¯ä»¥é‡ç½®ï¼‰
â†’ **ä½¿ç”¨æ–¹æ¡ˆ1**ï¼ˆä¿®æ”¹SQLï¼‰

### å¦‚æœå·²æœ‰ç”¨æˆ·æ•°æ®ï¼Œä¸èƒ½ä¸¢å¤±
â†’ **ä½¿ç”¨æ–¹æ¡ˆ2**ï¼ˆä¿®æ”¹åç«¯ï¼‰æˆ–**æ–¹æ¡ˆ1 + æ‰‹åŠ¨SQLæ¸…ç†**

### å¦‚æœåªæ˜¯ä¸´æ—¶éœ€æ±‚æˆ–å¿«é€Ÿæµ‹è¯•
â†’ **ä½¿ç”¨æ–¹æ¡ˆ3**ï¼ˆä¿®æ”¹å‰ç«¯ï¼‰

---

## ğŸ” æ–¹æ¡ˆ1çš„è¯¦ç»†SQLä¿®æ”¹ç¤ºä¾‹

### å®Œæ•´çš„ä¿®æ”¹åçš„SQLæ–‡ä»¶å†…å®¹ï¼ˆåªåŒ…å«Minimaxï¼‰

```sql
-- æœ¬æ–‡ä»¶ç”¨äºåˆå§‹åŒ–æ¨¡å‹é…ç½®æ•°æ®ï¼Œæ— éœ€æ‰‹åŠ¨æ‰§è¡Œï¼Œåœ¨é¡¹ç›®å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨æ‰§è¡Œ
-- -------------------------------------------------------
-- åˆå§‹åŒ–æ¨¡å‹é…ç½®æ•°æ®
DELETE FROM `ai_model_config`;

-- VADæ¨¡å‹é…ç½®ï¼ˆä¿æŒä¸å˜ï¼‰
INSERT INTO `ai_model_config` VALUES ('VAD_SileroVAD', 'VAD', 'SileroVAD', 'è¯­éŸ³æ´»åŠ¨æ£€æµ‹', 1, 1, '{\"type\": \"silero\", \"model_dir\": \"models/snakers4_silero-vad\", \"threshold\": 0.5, \"min_silence_duration_ms\": 700}', NULL, NULL, 1, NULL, NULL, NULL, NULL);

-- ASRæ¨¡å‹é…ç½®ï¼ˆä¿æŒä¸å˜ï¼Œæˆ–æ ¹æ®éœ€è¦è°ƒæ•´ï¼‰
INSERT INTO `ai_model_config` VALUES ('ASR_FunASR', 'ASR', 'FunASR', 'FunASRè¯­éŸ³è¯†åˆ«', 1, 1, '{\"type\": \"fun_local\", \"model_dir\": \"models/SenseVoiceSmall\", \"output_dir\": \"tmp/\"}', NULL, NULL, 1, NULL, NULL, NULL, NULL);
INSERT INTO `ai_model_config` VALUES ('ASR_DoubaoASR', 'ASR', 'DoubaoASR', 'è±†åŒ…è¯­éŸ³è¯†åˆ«', 0, 1, '{\"type\": \"doubao\", \"appid\": \"\", \"access_token\": \"\", \"cluster\": \"volcengine_input_common\", \"output_dir\": \"tmp/\"}', NULL, NULL, 2, NULL, NULL, NULL, NULL);

-- LLMæ¨¡å‹é…ç½®ï¼ˆåªä¿ç•™MinimaxLLMï¼‰â­
INSERT INTO `ai_model_config` VALUES ('LLM_MinimaxLLM', 'LLM', 'MinimaxLLM', 'MiniMaxå¤§è¯­è¨€æ¨¡å‹', 1, 1, '{\"type\": \"openai\", \"model_name\": \"abab6.5s-chat\", \"base_url\": \"https://api.minimaxi.com/v1\", \"api_key\": \"ä½ çš„api_key\", \"group_id\": \"ä½ çš„group_id\"}', 'https://www.minimaxi.com/document', 'æ”¯æŒOpenAIå…¼å®¹APIçš„å¤§è¯­è¨€æ¨¡å‹', 1, NULL, NULL, NULL, NULL);

-- TTSæ¨¡å‹é…ç½®ï¼ˆåªä¿ç•™MinimaxTTSï¼‰â­
INSERT INTO `ai_model_config` VALUES ('TTS_MinimaxTTS', 'TTS', 'MinimaxTTS', 'MiniMaxè¯­éŸ³åˆæˆ', 1, 1, '{\"type\": \"minimax_httpstream\", \"output_dir\": \"tmp/\", \"group_id\": \"ä½ çš„group_id\", \"api_key\": \"ä½ çš„api_key\", \"model\": \"speech-01-turbo\", \"voice_id\": \"female-shaonv\"}', 'https://www.minimaxi.com/document', 'é«˜è´¨é‡çš„è¯­éŸ³åˆæˆæœåŠ¡', 1, NULL, NULL, NULL, NULL);

-- Memoryæ¨¡å‹é…ç½®ï¼ˆä¿æŒä¸å˜ï¼‰
INSERT INTO `ai_model_config` VALUES ('Memory_nomem', 'Memory', 'nomem', 'æ— è®°å¿†', 1, 1, '{\"type\": \"nomem\"}', NULL, NULL, 1, NULL, NULL, NULL, NULL);

-- Intentæ¨¡å‹é…ç½®ï¼ˆä¿æŒä¸å˜ï¼‰
INSERT INTO `ai_model_config` VALUES ('Intent_function_call', 'Intent', 'function_call', 'å‡½æ•°è°ƒç”¨æ„å›¾è¯†åˆ«', 1, 1, '{\"type\": \"function_call\", \"functions\": [\"change_role\", \"get_weather\", \"get_news\", \"play_music\"]}', NULL, NULL, 1, NULL, NULL, NULL, NULL);
```

---

## ğŸš€ å®æ–½æ­¥éª¤æ€»ç»“

### ä½¿ç”¨æ–¹æ¡ˆ1çš„å®Œæ•´æ­¥éª¤ï¼š

1. **å¤‡ä»½ç°æœ‰æ•°æ®åº“**ï¼ˆå¦‚æœæœ‰é‡è¦æ•°æ®ï¼‰
   ```bash
   sudo docker exec xiaozhi-esp32-server-db mysqldump -u root -p xiaozhi > /tmp/xiaozhi_backup.sql
   ```

2. **ä¿®æ”¹SQLæ–‡ä»¶**
   ```bash
   nano /home/moshu/xiaozhi-esp32-server/main/manager-api/src/main/resources/db/changelog/202504112044.sql
   ```
   - åˆ é™¤ä¸éœ€è¦çš„LLMé…ç½®
   - åˆ é™¤ä¸éœ€è¦çš„TTSé…ç½®
   - æ·»åŠ MinimaxLLMé…ç½®ï¼ˆå¦‚æœæ²¡æœ‰ï¼‰
   - ä¿ç•™MinimaxTTSé…ç½®

3. **é‡æ–°æ„å»ºDockeré•œåƒ**ï¼ˆå¦‚æœæ˜¯æœ¬åœ°æ„å»ºï¼‰
   ```bash
   cd /home/moshu/xiaozhi-esp32-server/main/manager-api
   # æ„å»ºæ–°é•œåƒ
   ```

4. **æˆ–è€…ç›´æ¥æ¸…ç©ºæ•°æ®åº“å¹¶é‡å¯**
   ```bash
   cd /home/moshu/xiaozhi-esp32-server/main/xiaozhi-server
   sudo docker compose -f docker-compose_all.yml down -v
   sudo docker compose -f docker-compose_all.yml up -d
   ```

5. **éªŒè¯ç»“æœ**
   - è®¿é—®æ™ºæ§å°ï¼šhttp://10.73.194.94:8002
   - è¿›å…¥æ¨¡å‹é…ç½®é¡µé¢
   - ç¡®è®¤åªæ˜¾ç¤ºMinimaxLLMå’ŒMinimaxTTS

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ•°æ®å¤‡ä»½**ï¼šæ–¹æ¡ˆ1ä¼šæ¸…ç©ºç°æœ‰æ¨¡å‹é…ç½®ï¼Œè¯·åŠ¡å¿…å¤‡ä»½
2. **é…ç½®å®Œæ•´æ€§**ï¼šç¡®ä¿MinimaxLLMå’ŒMinimaxTTSçš„é…ç½®JSONå®Œæ•´
3. **å…¶ä»–æ¨¡å—**ï¼šVADã€ASRã€Memoryã€Intentç­‰é…ç½®å»ºè®®ä¿ç•™
4. **æµ‹è¯•ç¯å¢ƒ**ï¼šå»ºè®®å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯ï¼Œå†éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
5. **ç”¨æˆ·å½±å“**ï¼šå¦‚æœå·²æœ‰ç”¨æˆ·é…ç½®äº†å…¶ä»–æ¨¡å‹ï¼Œéœ€è¦è¿ç§»æˆ–é€šçŸ¥

---

## ğŸ“ ç›¸å…³æ–‡ä»¶æ¸…å•

```
æ¶‰åŠçš„æ–‡ä»¶ï¼š
â”œâ”€â”€ manager-api/
â”‚   â””â”€â”€ src/main/resources/db/changelog/
â”‚       â””â”€â”€ 202504112044.sql          â† ä¸»è¦ä¿®æ”¹æ–‡ä»¶
â”œâ”€â”€ manager-web/
â”‚   â””â”€â”€ src/views/
â”‚       â””â”€â”€ ModelConfig.vue           â† å‰ç«¯æ–¹æ¡ˆä¿®æ”¹
â””â”€â”€ manager-api/
    â””â”€â”€ src/main/java/xiaozhi/modules/model/
        â””â”€â”€ service/impl/
            â””â”€â”€ ModelConfigServiceImpl.java  â† åç«¯æ–¹æ¡ˆä¿®æ”¹
```

---

## ğŸ¯ æ€»ç»“

æ¨èä½¿ç”¨**æ–¹æ¡ˆ1ï¼ˆä¿®æ”¹SQLï¼‰**ï¼Œå› ä¸ºï¼š
- âœ… å®ç°æœ€ç®€å•
- âœ… æ€§èƒ½æœ€å¥½
- âœ… ç»´æŠ¤æœ€æ–¹ä¾¿
- âœ… ç”¨æˆ·ä½“éªŒæœ€ä½³

å¦‚æœæ‚¨ç¡®è®¤ä½¿ç”¨æ–¹æ¡ˆ1ï¼Œæˆ‘å¯ä»¥å¸®æ‚¨ï¼š
1. ç”Ÿæˆå®Œæ•´çš„ä¿®æ”¹åçš„SQLæ–‡ä»¶
2. æ‰§è¡Œå¤‡ä»½å’Œä¿®æ”¹æ“ä½œ
3. é‡æ–°éƒ¨ç½²æœåŠ¡
4. éªŒè¯ç»“æœ

è¯·å‘Šè¯‰æˆ‘æ‚¨é€‰æ‹©å“ªä¸ªæ–¹æ¡ˆï¼Œæˆ‘ä¼šååŠ©æ‚¨å®Œæˆå®æ–½ï¼


